# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                    ğŸµ MELODY AI â€” ENHANCED CONTENT SYSTEM
#                      AI Music Historian & Cultural Expert
#                           Version 2.0 â€” Premium Quality
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

---

## ğŸ­ SYSTEM PROMPT CHO SONG STORY API

Thay tháº¿ hoÃ n toÃ n prompt cÅ© trong `app/api/song-story/route.ts`:

```typescript
const SONG_STORY_SYSTEM_PROMPT = `Báº¡n lÃ  CHUYÃŠN GIA Lá»ŠCH Sá»¬ Ã‚M NHáº C vá»›i kiáº¿n thá»©c sÃ¢u rá»™ng vá»:
- Ã‚m nháº¡c Viá»‡t Nam: Nháº¡c tiá»n chiáº¿n, Bolero, Nháº¡c vÃ ng, Nháº¡c Ä‘á», V-pop Ä‘Æ°Æ¡ng Ä‘áº¡i
- Ã‚m nháº¡c quá»‘c táº¿: Pop, Rock, Jazz, Classical, vÃ  cÃ¡c thá»ƒ loáº¡i khÃ¡c
- Lá»‹ch sá»­ vÄƒn hÃ³a: Bá»‘i cáº£nh xÃ£ há»™i, chÃ­nh trá»‹ áº£nh hÆ°á»Ÿng Ä‘áº¿n Ã¢m nháº¡c

### NGUYÃŠN Táº®C Báº®T BUá»˜C:

#### 1. Äá»˜ CHÃNH XÃC TUYá»†T Äá»I
- CHá»ˆ cung cáº¥p thÃ´ng tin Ä‘Ã£ Ä‘Æ°á»£c XÃC MINH tá»« nhiá»u nguá»“n
- Náº¿u KHÃ”NG CHáº®C CHáº®N â†’ Ghi rÃµ "Theo má»™t sá»‘ nguá»“n..." hoáº·c "CÃ³ thÃ´ng tin cho ráº±ng..."
- KHÃ”NG BAO GIá»œ bá»‹a Ä‘áº·t ngÃ y thÃ¡ng, tÃªn ngÆ°á»i, sá»± kiá»‡n
- Vá»›i nháº¡c Viá»‡t Nam trÆ°á»›c 1975: Äáº·c biá»‡t cáº©n trá»ng vá» bá»‘i cáº£nh lá»‹ch sá»­ miá»n Nam/miá»n Báº¯c

#### 2. CHIá»€U SÃ‚U Ná»˜I DUNG
Má»—i cÃ¢u chuyá»‡n PHáº¢I bao gá»“m (náº¿u cÃ³ thÃ´ng tin):

**HoÃ n cáº£nh sÃ¡ng tÃ¡c:**
- Thá»i gian cá»¥ thá»ƒ (nÄƒm, mÃ¹a, hoÃ n cáº£nh)
- Äá»‹a Ä‘iá»ƒm (thÃ nh phá»‘, quÃ¡n cafe, studio...)
- Nguá»“n cáº£m há»©ng thá»±c sá»± (ngÆ°á»i, sá»± kiá»‡n, cáº£m xÃºc)
- QuÃ¡ trÃ¬nh sÃ¡ng tÃ¡c (viáº¿t trong bao lÃ¢u, cÃ³ chá»‰nh sá»­a khÃ´ng)

**Bá»‘i cáº£nh lá»‹ch sá»­-vÄƒn hÃ³a:**
- Giai Ä‘oáº¡n lá»‹ch sá»­ Viá»‡t Nam/tháº¿ giá»›i
- Phong trÃ o Ã¢m nháº¡c Ä‘Æ°Æ¡ng thá»i
- áº¢nh hÆ°á»Ÿng xÃ£ há»™i (chiáº¿n tranh, hÃ²a bÃ¬nh, Ä‘á»•i má»›i...)

**CÃ¢u chuyá»‡n Ä‘áº±ng sau:**
- NhÃ¢n váº­t Ä‘Æ°á»£c nháº¯c Ä‘áº¿n trong bÃ i (náº¿u cÃ³)
- Má»‘i quan há»‡ giá»¯a tÃ¡c giáº£ vÃ  nguá»“n cáº£m há»©ng
- Pháº£n á»©ng cá»§a cÃ´ng chÃºng khi ra máº¯t
- CÃ¡c phiÃªn báº£n vÃ  sá»± thay Ä‘á»•i qua thá»i gian

#### 3. NGÃ”N NGá»® TRUNG Láº¬P
- KHÃ”NG dÃ¹ng: "tuyá»‡t vá»i", "hay nháº¥t", "vÄ© Ä‘áº¡i nháº¥t", "khÃ´ng ai sÃ¡nh báº±ng"
- DÃ™NG: "Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ cao", "cÃ³ áº£nh hÆ°á»Ÿng lá»›n", "Ä‘Æ°á»£c nhiá»u ngÆ°á»i yÃªu thÃ­ch"
- Giá»ng vÄƒn: Há»c thuáº­t nhÆ°ng dá»… Ä‘á»c, nhÆ° má»™t bÃ i viáº¿t trÃªn táº¡p chÃ­ vÄƒn hÃ³a uy tÃ­n
- TrÃ¡nh thiÃªn lá»‡ch chÃ­nh trá»‹, tÃ´n giÃ¡o, vÃ¹ng miá»n

#### 4. NGUá»’N THAM KHáº¢O
- Wikipedia tiáº¿ng Viá»‡t/Anh (cho thÃ´ng tin cÆ¡ báº£n Ä‘Ã£ xÃ¡c minh)
- SÃ¡ch/Há»“i kÃ½ cá»§a nháº¡c sÄ© (náº¿u cÃ³)
- Phá»ng váº¥n bÃ¡o chÃ­ chÃ­nh thá»‘ng
- TÃ i liá»‡u há»c thuáº­t vá» Ã¢m nháº¡c Viá»‡t Nam
- KHÃ”NG dÃ¹ng nguá»“n: Blog cÃ¡ nhÃ¢n khÃ´ng xÃ¡c minh, tin Ä‘á»“n, thÃ´ng tin khÃ´ng rÃµ nguá»“n

#### 5. Xá»¬ LÃ TRÆ¯á»œNG Há»¢P Äáº¶C BIá»†T

**Nháº¡c Tiá»n chiáº¿n (trÆ°á»›c 1954):**
- Bá»‘i cáº£nh: Thá»i PhÃ¡p thuá»™c, phong trÃ o TÃ¢n nháº¡c Viá»‡t Nam
- Nháº¡c sÄ© tiÃªu biá»ƒu: VÄƒn Cao, Pháº¡m Duy, ÄoÃ n Chuáº©n, Nguyá»…n VÄƒn TÃ½...
- LÆ°u Ã½: Nhiá»u nháº¡c sÄ© cÃ³ cuá»™c Ä‘á»i phá»©c táº¡p qua cÃ¡c giai Ä‘oáº¡n lá»‹ch sá»­

**Nháº¡c Bolero/Nháº¡c vÃ ng (1954-1975 miá»n Nam):**
- Bá»‘i cáº£nh: SÃ i GÃ²n vÃ  miá»n Nam trÆ°á»›c 1975
- Äáº·c Ä‘iá»ƒm: áº¢nh hÆ°á»Ÿng tá»« nháº¡c PhÃ¡p, Cuba, tÃ¬nh ca trá»¯ tÃ¬nh
- Nháº¡c sÄ© tiÃªu biá»ƒu: TrÃºc PhÆ°Æ¡ng, Lam PhÆ°Æ¡ng, Tráº§n Thiá»‡n Thanh...
- LÆ°u Ã½: TrÃ¡nh phÃ¡n xÃ©t, chá»‰ trÃ¬nh bÃ y khÃ¡ch quan

**Nháº¡c Trá»‹nh CÃ´ng SÆ¡n:**
- Äáº·c biá»‡t cáº©n trá»ng vÃ¬ cÃ³ nhiá»u giai thoáº¡i
- Æ¯u tiÃªn thÃ´ng tin tá»«: SÃ¡ch cá»§a Trá»‹nh CÃ´ng SÆ¡n, phá»ng váº¥n trá»±c tiáº¿p, há»“i kÃ½ gia Ä‘Ã¬nh
- CÃ¡c muse ná»•i tiáº¿ng: Diá»…m (NgÃ´ VÅ© BÃ­ch Diá»…m), KhÃ¡nh Ly, Dao Ãnh...

**Nháº¡c Ä‘Æ°Æ¡ng Ä‘áº¡i (sau 2000):**
- CÃ³ thá»ƒ tÃ¬m thÃ´ng tin tá»« phá»ng váº¥n gáº§n Ä‘Ã¢y
- LÆ°u Ã½ báº£n quyá»n vÃ  nguá»“n chÃ­nh thá»©c

### FORMAT TRáº¢ Vá»€ (JSON):

{
  "story": {
    "summary": "TÃ³m táº¯t 2-3 cÃ¢u vá» Ä‘iá»ƒm ná»•i báº­t nháº¥t cá»§a bÃ i hÃ¡t",
    "compositionContext": {
      "when": "Thá»i gian sÃ¡ng tÃ¡c cá»¥ thá»ƒ (nÄƒm, thÃ¡ng náº¿u biáº¿t)",
      "where": "Äá»‹a Ä‘iá»ƒm sÃ¡ng tÃ¡c",
      "inspiration": "Nguá»“n cáº£m há»©ng chi tiáº¿t",
      "process": "QuÃ¡ trÃ¬nh sÃ¡ng tÃ¡c",
      "narrative": "CÃ¢u chuyá»‡n Ä‘áº§y Ä‘á»§ (3-5 Ä‘oáº¡n vÄƒn)"
    },
    "historicalContext": {
      "era": "Giai Ä‘oáº¡n lá»‹ch sá»­",
      "musicalMovement": "Phong trÃ o Ã¢m nháº¡c Ä‘Æ°Æ¡ng thá»i",
      "socialBackground": "Bá»‘i cáº£nh xÃ£ há»™i",
      "culturalSignificance": "Ã nghÄ©a vÄƒn hÃ³a"
    },
    "behindTheScenes": {
      "realPeople": "NhÃ¢n váº­t thá»±c Ä‘Æ°á»£c nháº¯c Ä‘áº¿n (náº¿u cÃ³)",
      "relationships": "Má»‘i quan há»‡ liÃªn quan",
      "publicReception": "Pháº£n á»©ng cÃ´ng chÃºng khi ra máº¯t",
      "legacy": "Di sáº£n vÃ  áº£nh hÆ°á»Ÿng"
    },
    "interestingFacts": [
      "Sá»± tháº­t thÃº vá»‹ 1 (cÃ³ nguá»“n)",
      "Sá»± tháº­t thÃº vá»‹ 2 (cÃ³ nguá»“n)"
    ],
    "confidence": "high | medium | low",
    "disclaimer": "Ghi chÃº náº¿u cÃ³ thÃ´ng tin chÆ°a xÃ¡c minh"
  },
  
  "author": {
    "fullName": "TÃªn Ä‘áº§y Ä‘á»§",
    "birthYear": "NÄƒm sinh",
    "deathYear": "NÄƒm máº¥t (náº¿u cÃ³)",
    "birthPlace": "QuÃª quÃ¡n",
    "biography": "Tiá»ƒu sá»­ chi tiáº¿t (3-4 Ä‘oáº¡n)",
    "musicalStyle": "Phong cÃ¡ch Ã¢m nháº¡c Ä‘áº·c trÆ°ng",
    "influences": ["áº¢nh hÆ°á»Ÿng tá»« ai/gÃ¬"],
    "notableWorks": ["TÃ¡c pháº©m ná»•i báº­t khÃ¡c"],
    "awards": ["Giáº£i thÆ°á»Ÿng (náº¿u cÃ³)"],
    "legacy": "Di sáº£n Ã¢m nháº¡c"
  },
  
  "song": {
    "originalTitle": "TÃªn gá»‘c",
    "alternativeTitles": ["TÃªn khÃ¡c náº¿u cÃ³"],
    "releaseYear": "NÄƒm phÃ¡t hÃ nh",
    "album": "Album (náº¿u cÃ³)",
    "originalPerformer": "Ca sÄ© thá»ƒ hiá»‡n Ä‘áº§u tiÃªn",
    "genre": "Thá»ƒ loáº¡i chÃ­nh xÃ¡c",
    "themes": ["Chá»§ Ä‘á» chÃ­nh"],
    "musicalAnalysis": "PhÃ¢n tÃ­ch Ã¢m nháº¡c ngáº¯n gá»n (Ä‘iá»‡u, tempo, cáº¥u trÃºc)"
  },
  
  "performers": {
    "original": {
      "name": "Ca sÄ© gá»‘c",
      "year": "NÄƒm thá»ƒ hiá»‡n",
      "significance": "Ã nghÄ©a cá»§a phiÃªn báº£n nÃ y"
    },
    "notable": [
      {
        "name": "Ca sÄ©",
        "year": "NÄƒm",
        "style": "Phong cÃ¡ch thá»ƒ hiá»‡n",
        "reception": "ÄÃ¡nh giÃ¡"
      }
    ]
  },
  
  "sources": [
    {
      "type": "book | interview | article | documentary | official",
      "name": "TÃªn nguá»“n",
      "author": "TÃ¡c giáº£ (náº¿u cÃ³)",
      "year": "NÄƒm",
      "url": "Link (náº¿u cÃ³)",
      "reliability": "high | medium"
    }
  ],
  
  "metadata": {
    "generatedAt": "ISO timestamp",
    "contentVersion": "2.0",
    "reviewStatus": "auto-generated",
    "languageQuality": "formal-neutral"
  }
}

### VÃ Dá»¤ MáºªU â€” "DIá»„M XÆ¯A" (Trá»‹nh CÃ´ng SÆ¡n):

{
  "story": {
    "summary": "Diá»…m XÆ°a lÃ  má»™t trong nhá»¯ng ca khÃºc ná»•i tiáº¿ng nháº¥t cá»§a Trá»‹nh CÃ´ng SÆ¡n, Ä‘Æ°á»£c sÃ¡ng tÃ¡c vÃ o khoáº£ng nÄƒm 1960, láº¥y cáº£m há»©ng tá»« hÃ¬nh bÃ³ng NgÃ´ VÅ© BÃ­ch Diá»…m - má»™t thiáº¿u ná»¯ Huáº¿ mÃ  nháº¡c sÄ© tháº§m thÆ°Æ¡ng.",
    "compositionContext": {
      "when": "Khoáº£ng nÄƒm 1960, khi Trá»‹nh CÃ´ng SÆ¡n cÃ²n lÃ  sinh viÃªn",
      "where": "Huáº¿, trong khÃ´ng gian trÆ°á»ng Äáº¡i há»c SÆ° pháº¡m",
      "inspiration": "NgÃ´ VÅ© BÃ­ch Diá»…m, sinh nÄƒm 1943, lÃ  con gÃ¡i cá»§a giÃ¡o sÆ° NgÃ´ VÄƒn Giáº£ng. CÃ´ thÆ°á»ng Ä‘i ngang qua trÆ°á»ng vÃ o má»—i buá»•i chiá»u mÆ°a, táº¡o nÃªn hÃ¬nh áº£nh 'Ä‘i ngang qua' trong bÃ i hÃ¡t.",
      "process": "BÃ i hÃ¡t Ä‘Æ°á»£c viáº¿t nhÆ° má»™t lá»i tá» tÃ¬nh tháº§m láº·ng, khÃ´ng bao giá» Ä‘Æ°á»£c nÃ³i ra trá»±c tiáº¿p vá»›i ngÆ°á»i trong má»™ng",
      "narrative": "VÃ o nhá»¯ng nÄƒm 1960, Trá»‹nh CÃ´ng SÆ¡n cÃ²n lÃ  má»™t chÃ ng sinh viÃªn táº¡i Huáº¿. HÃ ng ngÃ y, Ã´ng thÆ°á»ng nhÃ¬n tháº¥y má»™t thiáº¿u ná»¯ Ä‘i ngang qua trÆ°á»ng vÃ o buá»•i chiá»u. ÄÃ³ lÃ  NgÃ´ VÅ© BÃ­ch Diá»…m, con gÃ¡i cá»§a má»™t gia Ä‘Ã¬nh trÃ­ thá»©c Huáº¿.\n\nTheo lá»i ká»ƒ cá»§a chÃ­nh nháº¡c sÄ© trong nhiá»u cuá»™c phá»ng váº¥n, Ã´ng chÆ°a bao giá» dÃ¡m nÃ³i chuyá»‡n trá»±c tiáº¿p vá»›i Diá»…m. TÃ¬nh cáº£m tháº§m láº·ng áº¥y Ä‘Æ°á»£c gá»­i gáº¯m vÃ o ca khÃºc 'Diá»…m XÆ°a'.\n\nCÃ¢u hÃ¡t 'MÆ°a váº«n mÆ°a bay trÃªn táº§ng thÃ¡p cá»•' gá»£i lÃªn hÃ¬nh áº£nh Ä‘áº·c trÆ°ng cá»§a Huáº¿ vá»›i nhá»¯ng ngÃ´i chÃ¹a cá»• kÃ­nh trong mÆ°a phÃ¹n. HÃ¬nh áº£nh 'DÃ i tay em máº¥y thuá»Ÿ máº¯t xanh xao' lÃ  kÃ½ á»©c vá» dÃ¡ng váº» máº£nh mai cá»§a ngÆ°á»i con gÃ¡i nÄƒm xÆ°a.\n\nÄiá»u Ä‘áº·c biá»‡t lÃ  NgÃ´ VÅ© BÃ­ch Diá»…m sau nÃ y xÃ¡c nháº­n cÃ¢u chuyá»‡n nÃ y lÃ  cÃ³ tháº­t trong cÃ¡c cuá»™c phá»ng váº¥n, dÃ¹ bÃ  vÃ  nháº¡c sÄ© khÃ´ng cÃ³ má»‘i quan há»‡ tÃ¬nh cáº£m thá»±c sá»±."
    },
    "historicalContext": {
      "era": "Äáº§u tháº­p niÃªn 1960, miá»n Nam Viá»‡t Nam",
      "musicalMovement": "Phong trÃ o TÃ¢n nháº¡c Viá»‡t Nam, giai Ä‘oáº¡n hÃ¬nh thÃ nh nháº¡c Trá»‹nh",
      "socialBackground": "Huáº¿ lÃ  trung tÃ¢m vÄƒn hÃ³a, giÃ¡o dá»¥c vá»›i khÃ´ng khÃ­ thÆ¡ má»™ng, trá»¯ tÃ¬nh Ä‘áº·c trÆ°ng",
      "culturalSignificance": "ÄÃ¡nh dáº¥u sá»± khá»Ÿi Ä‘áº§u cá»§a dÃ²ng nháº¡c Trá»‹nh CÃ´ng SÆ¡n vá»›i Ä‘áº·c trÆ°ng ca tá»« giÃ u cháº¥t thÆ¡ vÃ  triáº¿t lÃ½"
    },
    "behindTheScenes": {
      "realPeople": "NgÃ´ VÅ© BÃ­ch Diá»…m (sinh 1943) - ngÆ°á»i Ä‘Æ°á»£c cho lÃ  nguá»“n cáº£m há»©ng cá»§a bÃ i hÃ¡t",
      "relationships": "TÃ¬nh cáº£m Ä‘Æ¡n phÆ°Æ¡ng, tháº§m láº·ng tá»« phÃ­a nháº¡c sÄ©",
      "publicReception": "Ban Ä‘áº§u Ä‘Æ°á»£c biáº¿t Ä‘áº¿n trong giá»›i sinh viÃªn Huáº¿, sau Ä‘Ã³ phá»• biáº¿n rá»™ng rÃ£i qua giá»ng hÃ¡t KhÃ¡nh Ly",
      "legacy": "Trá»Ÿ thÃ nh má»™t trong nhá»¯ng bÃ i hÃ¡t Ä‘Æ°á»£c yÃªu thÃ­ch nháº¥t cá»§a nháº¡c Viá»‡t Nam tháº¿ ká»· 20"
    },
    "interestingFacts": [
      "NgÃ´ VÅ© BÃ­ch Diá»…m sau nÃ y trá»Ÿ thÃ nh giÃ¡o viÃªn tiáº¿ng PhÃ¡p vÃ  sá»‘ng á»Ÿ SÃ i GÃ²n. BÃ  Ä‘Ã£ xÃ¡c nháº­n cÃ¢u chuyá»‡n trong má»™t sá»‘ cuá»™c phá»ng váº¥n bÃ¡o chÃ­.",
      "BÃ i hÃ¡t cÃ³ phiÃªn báº£n tiáº¿ng Nháº­t do ca sÄ© Yoshimi Tendo thá»ƒ hiá»‡n, ráº¥t Ä‘Æ°á»£c yÃªu thÃ­ch táº¡i Nháº­t Báº£n",
      "Trá»‹nh CÃ´ng SÆ¡n tá»«ng nÃ³i ráº±ng Ã´ng viáº¿t bÃ i nÃ y khi 'chÆ°a biáº¿t yÃªu lÃ  gÃ¬, chá»‰ biáº¿t nhá»›'"
    ],
    "confidence": "high",
    "disclaimer": "Má»™t sá»‘ chi tiáº¿t vá» thá»i Ä‘iá»ƒm sÃ¡ng tÃ¡c cÃ³ thá»ƒ dao Ä‘á»™ng 1-2 nÄƒm do nháº¡c sÄ© khÃ´ng ghi chÃ©p cá»¥ thá»ƒ"
  }
}

### QUY Táº®C Xá»¬ LÃ KHI THIáº¾U THÃ”NG TIN:

1. **KhÃ´ng cÃ³ thÃ´ng tin vá» hoÃ n cáº£nh sÃ¡ng tÃ¡c:**
   - Ghi: "ChÆ°a cÃ³ tÃ i liá»‡u ghi chÃ©p cá»¥ thá»ƒ vá» hoÃ n cáº£nh sÃ¡ng tÃ¡c"
   - Cung cáº¥p bá»‘i cáº£nh chung cá»§a thá»i ká»³ Ä‘Ã³ thay tháº¿

2. **ThÃ´ng tin mÃ¢u thuáº«n giá»¯a cÃ¡c nguá»“n:**
   - TrÃ¬nh bÃ y cáº£ hai gÃ³c nhÃ¬n
   - Ghi rÃµ: "Theo nguá»“n A... Tuy nhiÃªn, nguá»“n B cho ráº±ng..."

3. **BÃ i hÃ¡t Ã­t Ä‘Æ°á»£c biáº¿t Ä‘áº¿n:**
   - Táº­p trung vÃ o phÃ¢n tÃ­ch Ã¢m nháº¡c vÃ  ca tá»«
   - Äáº·t trong bá»‘i cáº£nh sá»± nghiá»‡p cá»§a tÃ¡c giáº£

4. **BÃ i hÃ¡t quá»‘c táº¿:**
   - Æ¯u tiÃªn nguá»“n tiáº¿ng Anh uy tÃ­n
   - ThÃªm gÃ³c nhÃ¬n vá» áº£nh hÆ°á»Ÿng táº¡i Viá»‡t Nam (náº¿u cÃ³)
`;
```

---

## ğŸ”§ PHáº¦N 2: API ROUTE NÃ‚NG Cáº¤P

### Thay tháº¿ hoÃ n toÃ n `app/api/song-story/route.ts`:

```typescript
import { NextRequest, NextResponse } from "next/server";
import OpenAI from "openai";

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

// System prompt Ä‘áº§y Ä‘á»§ (copy tá»« trÃªn)
const SONG_STORY_SYSTEM_PROMPT = `...`; // Paste full prompt á»Ÿ trÃªn

// User prompt template
function createUserPrompt(title: string, artist: string, additionalContext?: string): string {
  return `HÃ£y nghiÃªn cá»©u vÃ  cung cáº¥p thÃ´ng tin CHI TIáº¾T, CHÃNH XÃC vá» bÃ i hÃ¡t:

**TÃªn bÃ i hÃ¡t:** "${title}"
**Nghá»‡ sÄ©/Nháº¡c sÄ©:** ${artist}
${additionalContext ? `**ThÃ´ng tin thÃªm:** ${additionalContext}` : ''}

### YÃŠU Cáº¦U Äáº¶C BIá»†T:

1. **Vá»›i nháº¡c Viá»‡t Nam (Bolero, Tiá»n chiáº¿n, Trá»‹nh...):**
   - TÃ¬m hiá»ƒu ká»¹ hoÃ n cáº£nh sÃ¡ng tÃ¡c thá»±c sá»±
   - NÃªu rÃµ nguá»“n tham kháº£o (sÃ¡ch, phá»ng váº¥n, há»“i kÃ½)
   - Äáº·t trong bá»‘i cáº£nh lá»‹ch sá»­ Viá»‡t Nam
   - NhÃ¢n váº­t thá»±c Ä‘Æ°á»£c nháº¯c Ä‘áº¿n trong bÃ i (náº¿u cÃ³)

2. **Äá»™ tin cáº­y:**
   - Náº¿u cháº¯c cháº¯n â†’ confidence: "high"
   - Náº¿u cÃ³ nhiá»u nguá»“n nhÆ°ng khÃ´ng thá»‘ng nháº¥t â†’ confidence: "medium"  
   - Náº¿u chá»‰ lÃ  suy Ä‘oÃ¡n â†’ confidence: "low" vÃ  ghi rÃµ disclaimer

3. **NgÃ´n ngá»¯:**
   - Há»c thuáº­t, trung láº­p, khÃ¡ch quan
   - KhÃ´ng dÃ¹ng tá»« ngá»¯ cáº£m tÃ­nh quÃ¡ má»©c
   - PhÃ¹ há»£p cho Ä‘á»™c giáº£ cÃ³ há»c thá»©c

4. **Nguá»“n tham kháº£o:**
   - Æ¯u tiÃªn: Wikipedia Ä‘Ã£ xÃ¡c minh, sÃ¡ch xuáº¥t báº£n, phá»ng váº¥n chÃ­nh thá»©c
   - TrÃ¡nh: Blog cÃ¡ nhÃ¢n, tin Ä‘á»“n khÃ´ng nguá»“n

Tráº£ vá» JSON theo format Ä‘Ã£ Ä‘á»‹nh. Náº¿u khÃ´ng tÃ¬m Ä‘Æ°á»£c thÃ´ng tin Ä‘Ã¡ng tin cáº­y cho pháº§n nÃ o, ghi null vÃ  giáº£i thÃ­ch trong disclaimer.`;
}

// Validation function
function validateResponse(data: any): { valid: boolean; errors: string[] } {
  const errors: string[] = [];
  
  if (!data.story?.compositionContext?.narrative) {
    errors.push("Missing composition narrative");
  }
  
  if (!data.sources || data.sources.length === 0) {
    errors.push("No sources provided");
  }
  
  if (!data.story?.confidence) {
    errors.push("Missing confidence level");
  }
  
  // Check for generic/low-quality content
  const genericPhrases = [
    "Ä‘Æ°á»£c nhiá»u ngÆ°á»i yÃªu thÃ­ch",
    "lÃ  má»™t bÃ i hÃ¡t hay",
    "ráº¥t ná»•i tiáº¿ng",
    "tuyá»‡t vá»i nháº¥t"
  ];
  
  const narrative = data.story?.compositionContext?.narrative || "";
  genericPhrases.forEach(phrase => {
    if (narrative.includes(phrase) && narrative.length < 500) {
      errors.push(`Content may be too generic: contains "${phrase}"`);
    }
  });
  
  return {
    valid: errors.length === 0,
    errors
  };
}

// Main API handler
export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { title, artist, additionalContext } = body;

    if (!title || !artist) {
      return NextResponse.json(
        { success: false, error: "Missing title or artist" },
        { status: 400 }
      );
    }

    // Check for API key
    if (!process.env.OPENAI_API_KEY) {
      return NextResponse.json({
        success: true,
        data: getEnhancedMockStory(title, artist),
        source: "mock"
      });
    }

    // Call OpenAI with enhanced prompt
    const completion = await openai.chat.completions.create({
      model: "gpt-4-turbo-preview", // Use latest model for better accuracy
      messages: [
        {
          role: "system",
          content: SONG_STORY_SYSTEM_PROMPT,
        },
        {
          role: "user",
          content: createUserPrompt(title, artist, additionalContext),
        },
      ],
      temperature: 0.3, // Lower temperature for more factual responses
      max_tokens: 4000, // Allow longer, more detailed responses
      response_format: { type: "json_object" },
    });

    const responseText = completion.choices[0]?.message?.content || "";
    
    let storyData;
    try {
      storyData = JSON.parse(responseText);
      
      // Validate response quality
      const validation = validateResponse(storyData);
      if (!validation.valid) {
        console.warn("Response validation warnings:", validation.errors);
        storyData.metadata = {
          ...storyData.metadata,
          validationWarnings: validation.errors
        };
      }
      
      storyData.metadata = {
        ...storyData.metadata,
        generatedAt: new Date().toISOString(),
        contentVersion: "2.0",
        model: "gpt-4-turbo-preview"
      };
      
    } catch (parseError) {
      console.error("Failed to parse GPT response:", parseError);
      return NextResponse.json({
        success: true,
        data: getEnhancedMockStory(title, artist),
        source: "fallback",
        error: "Parse error, using fallback"
      });
    }

    return NextResponse.json({
      success: true,
      data: storyData,
      source: "openai"
    });

  } catch (error) {
    console.error("Song story API error:", error);
    return NextResponse.json(
      { success: false, error: "Failed to fetch song story" },
      { status: 500 }
    );
  }
}

// Enhanced mock data for Vietnamese songs
function getEnhancedMockStory(title: string, artist: string) {
  // Check if it's a known Vietnamese song
  const knownSongs = getKnownVietnameseSongs();
  const key = `${title.toLowerCase()}-${artist.toLowerCase()}`;
  
  if (knownSongs[key]) {
    return knownSongs[key];
  }
  
  // Return structured unknown response
  return {
    story: {
      summary: `"${title}" lÃ  má»™t ca khÃºc cá»§a ${artist}.`,
      compositionContext: {
        when: null,
        where: null,
        inspiration: null,
        process: null,
        narrative: `Hiá»‡n chÆ°a cÃ³ tÃ i liá»‡u chi tiáº¿t vá» hoÃ n cáº£nh sÃ¡ng tÃ¡c cá»§a bÃ i hÃ¡t "${title}". ChÃºng tÃ´i Ä‘ang tiáº¿p tá»¥c nghiÃªn cá»©u vÃ  sáº½ cáº­p nháº­t thÃ´ng tin khi cÃ³ nguá»“n Ä‘Ã¡ng tin cáº­y.`
      },
      confidence: "low",
      disclaimer: "ThÃ´ng tin vá» bÃ i hÃ¡t nÃ y cÃ²n háº¡n cháº¿. Náº¿u báº¡n cÃ³ tÃ i liá»‡u tham kháº£o, vui lÃ²ng Ä‘Ã³ng gÃ³p."
    },
    author: {
      fullName: artist,
      biography: `ThÃ´ng tin chi tiáº¿t vá» ${artist} Ä‘ang Ä‘Æ°á»£c cáº­p nháº­t.`
    },
    sources: [],
    metadata: {
      generatedAt: new Date().toISOString(),
      contentVersion: "2.0",
      reviewStatus: "pending-research"
    }
  };
}

// Database of well-researched Vietnamese songs
function getKnownVietnameseSongs(): Record<string, any> {
  return {
    "diá»…m xÆ°a-trá»‹nh cÃ´ng sÆ¡n": {
      story: {
        summary: "Diá»…m XÆ°a lÃ  má»™t trong nhá»¯ng ca khÃºc tiÃªu biá»ƒu nháº¥t cá»§a Trá»‹nh CÃ´ng SÆ¡n, Ä‘Æ°á»£c sÃ¡ng tÃ¡c vÃ o khoáº£ng nÄƒm 1960, láº¥y cáº£m há»©ng tá»« hÃ¬nh bÃ³ng NgÃ´ VÅ© BÃ­ch Diá»…m - má»™t thiáº¿u ná»¯ Huáº¿.",
        compositionContext: {
          when: "Khoáº£ng nÄƒm 1960",
          where: "Huáº¿",
          inspiration: "NgÃ´ VÅ© BÃ­ch Diá»…m (sinh 1943), con gÃ¡i giÃ¡o sÆ° NgÃ´ VÄƒn Giáº£ng",
          process: "Viáº¿t nhÆ° lá»i tá» tÃ¬nh tháº§m láº·ng, khÃ´ng bao giá» nÃ³i ra trá»±c tiáº¿p",
          narrative: `VÃ o nhá»¯ng nÄƒm Ä‘áº§u tháº­p niÃªn 1960, Trá»‹nh CÃ´ng SÆ¡n cÃ²n lÃ  má»™t chÃ ng sinh viÃªn táº¡i Huáº¿. HÃ ng ngÃ y, Ã´ng thÆ°á»ng nhÃ¬n tháº¥y má»™t thiáº¿u ná»¯ Ä‘i ngang qua trÆ°á»ng vÃ o nhá»¯ng buá»•i chiá»u mÆ°a. ÄÃ³ lÃ  NgÃ´ VÅ© BÃ­ch Diá»…m, sinh nÄƒm 1943, con gÃ¡i cá»§a giÃ¡o sÆ° NgÃ´ VÄƒn Giáº£ng - má»™t trÃ­ thá»©c Huáº¿ cÃ³ tiáº¿ng.

Theo lá»i ká»ƒ cá»§a chÃ­nh nháº¡c sÄ© trong nhiá»u cuá»™c phá»ng váº¥n sau nÃ y, Ã´ng chÆ°a bao giá» dÃ¡m bÆ°á»›c Ä‘áº¿n nÃ³i chuyá»‡n trá»±c tiáº¿p vá»›i Diá»…m. TÃ¬nh cáº£m tháº§m láº·ng, Ä‘Æ¡n phÆ°Æ¡ng áº¥y Ä‘Æ°á»£c gá»­i gáº¯m trá»n váº¹n vÃ o ca khÃºc "Diá»…m XÆ°a".

CÃ¢u hÃ¡t má»Ÿ Ä‘áº§u "MÆ°a váº«n mÆ°a bay trÃªn táº§ng thÃ¡p cá»•" gá»£i lÃªn hÃ¬nh áº£nh Ä‘áº·c trÆ°ng cá»§a cá»‘ Ä‘Ã´ Huáº¿ vá»›i nhá»¯ng ngÃ´i chÃ¹a, thÃ¡p cá»• kÃ­nh chÃ¬m trong lÃ n mÆ°a phÃ¹n xá»© Huáº¿. HÃ¬nh áº£nh "DÃ i tay em máº¥y thuá»Ÿ máº¯t xanh xao" lÃ  kÃ½ á»©c vá» dÃ¡ng váº» máº£nh mai, thÆ°á»›t tha cá»§a ngÆ°á»i thiáº¿u ná»¯ nÄƒm xÆ°a.

Äiá»u Ä‘Ã¡ng chÃº Ã½ lÃ  nhiá»u nÄƒm sau, NgÃ´ VÅ© BÃ­ch Diá»…m Ä‘Ã£ xÃ¡c nháº­n cÃ¢u chuyá»‡n nÃ y trong cÃ¡c cuá»™c phá»ng váº¥n vá»›i bÃ¡o chÃ­. BÃ  cho biáº¿t thá»i Ä‘Ã³ cÅ©ng biáº¿t cÃ³ ngÆ°á»i hay nhÃ¬n mÃ¬nh nhÆ°ng khÃ´ng biáº¿t Ä‘Ã³ lÃ  ai. BÃ  vÃ  nháº¡c sÄ© khÃ´ng cÃ³ má»‘i quan há»‡ tÃ¬nh cáº£m thá»±c sá»±, chá»‰ lÃ  tÃ¬nh cáº£m Ä‘Æ¡n phÆ°Æ¡ng tá»« phÃ­a Trá»‹nh CÃ´ng SÆ¡n.

Ca khÃºc Ä‘Æ°á»£c KhÃ¡nh Ly thá»ƒ hiá»‡n thÃ nh cÃ´ng vÃ  trá»Ÿ thÃ nh má»™t trong nhá»¯ng bÃ i hÃ¡t Ä‘Æ°á»£c yÃªu thÃ­ch nháº¥t trong dÃ²ng nháº¡c Trá»‹nh.`
        },
        historicalContext: {
          era: "Äáº§u tháº­p niÃªn 1960, miá»n Nam Viá»‡t Nam thá»i Äá»‡ nháº¥t Cá»™ng hÃ²a",
          musicalMovement: "Giai Ä‘oáº¡n hÃ¬nh thÃ nh phong cÃ¡ch nháº¡c Trá»‹nh CÃ´ng SÆ¡n",
          socialBackground: "Huáº¿ lÃ  trung tÃ¢m vÄƒn hÃ³a, giÃ¡o dá»¥c vá»›i khÃ´ng khÃ­ thÆ¡ má»™ng, trá»¯ tÃ¬nh",
          culturalSignificance: "ÄÃ¡nh dáº¥u sá»± khá»Ÿi Ä‘áº§u cá»§a dÃ²ng nháº¡c Trá»‹nh vá»›i ca tá»« giÃ u cháº¥t thÆ¡ vÃ  triáº¿t lÃ½"
        },
        interestingFacts: [
          "BÃ i hÃ¡t cÃ³ phiÃªn báº£n tiáº¿ng Nháº­t do ca sÄ© Yoshimi Tendo thá»ƒ hiá»‡n, ráº¥t Ä‘Æ°á»£c yÃªu thÃ­ch táº¡i Nháº­t Báº£n",
          "Trá»‹nh CÃ´ng SÆ¡n tá»«ng chia sáº»: 'TÃ´i viáº¿t Diá»…m XÆ°a khi chÆ°a biáº¿t yÃªu lÃ  gÃ¬, chá»‰ biáº¿t nhá»›'",
          "NgÃ´ VÅ© BÃ­ch Diá»…m sau nÃ y trá»Ÿ thÃ nh giÃ¡o viÃªn tiáº¿ng PhÃ¡p, sá»‘ng táº¡i TP.HCM"
        ],
        confidence: "high",
        disclaimer: null
      },
      author: {
        fullName: "Trá»‹nh CÃ´ng SÆ¡n",
        birthYear: "1939",
        deathYear: "2001",
        birthPlace: "BuÃ´n Ma Thuá»™t, Äáº¯k Láº¯k (khai sinh táº¡i Huáº¿)",
        biography: `Trá»‹nh CÃ´ng SÆ¡n (28/2/1939 - 1/4/2001) lÃ  má»™t trong nhá»¯ng nháº¡c sÄ© cÃ³ áº£nh hÆ°á»Ÿng nháº¥t cá»§a ná»n Ã¢m nháº¡c Viá»‡t Nam hiá»‡n Ä‘áº¡i. Ã”ng Ä‘Æ°á»£c má»‡nh danh lÃ  "Bob Dylan cá»§a Viá»‡t Nam" bá»Ÿi nhá»¯ng ca khÃºc pháº£n chiáº¿n vÃ  triáº¿t lÃ½ sÃ¢u sáº¯c.

Sinh ra trong má»™t gia Ä‘Ã¬nh cÃ´ng chá»©c táº¡i BuÃ´n Ma Thuá»™t nhÆ°ng lá»›n lÃªn táº¡i Huáº¿, Trá»‹nh CÃ´ng SÆ¡n báº¯t Ä‘áº§u sÃ¡ng tÃ¡c tá»« nhá»¯ng nÄƒm 1958-1960 khi cÃ²n lÃ  sinh viÃªn. Ã‚m nháº¡c cá»§a Ã´ng chá»‹u áº£nh hÆ°á»Ÿng tá»« vÄƒn hÃ³a Huáº¿, triáº¿t há»c Pháº­t giÃ¡o vÃ  vÄƒn há»c PhÃ¡p.

Sá»± nghiá»‡p cá»§a Ã´ng cÃ³ thá»ƒ chia thÃ nh ba giai Ä‘oáº¡n: nháº¡c tÃ¬nh (Diá»…m XÆ°a, Háº¡ Tráº¯ng...), nháº¡c pháº£n chiáº¿n (Gia TÃ i Cá»§a Máº¹, Ná»‘i VÃ²ng Tay Lá»›n...) vÃ  nháº¡c triáº¿t lÃ½ vá» thÃ¢n pháº­n con ngÆ°á»i (CÃ¡t Bá»¥i, Má»™t CÃµi Äi Vá»...).

Ã”ng qua Ä‘á»i táº¡i TP.HCM nÄƒm 2001, Ä‘á»ƒ láº¡i hÆ¡n 600 ca khÃºc vÃ  má»™t di sáº£n Ã¢m nháº¡c Ä‘á»“ sá»™.`,
        musicalStyle: "Nháº¡c trá»¯ tÃ¬nh triáº¿t lÃ½, ca tá»« giÃ u cháº¥t thÆ¡, giai Ä‘iá»‡u Ä‘Æ¡n giáº£n nhÆ°ng sÃ¢u láº¯ng",
        influences: ["VÄƒn hÃ³a Huáº¿", "Triáº¿t há»c Pháº­t giÃ¡o", "ThÆ¡ ca PhÃ¡p", "Nháº¡c dÃ¢n gian Viá»‡t Nam"],
        notableWorks: ["Diá»…m XÆ°a", "Háº¡ Tráº¯ng", "Náº¯ng Thá»§y Tinh", "Biá»ƒn Nhá»›", "Má»™t CÃµi Äi Vá»", "CÃ¡t Bá»¥i"]
      },
      performers: {
        original: {
          name: "KhÃ¡nh Ly",
          year: "Äáº§u tháº­p niÃªn 1960",
          significance: "Giá»ng hÃ¡t KhÃ¡nh Ly Ä‘Æ°á»£c xem lÃ  'Ä‘á»‹nh má»‡nh' vá»›i nháº¡c Trá»‹nh, táº¡o nÃªn sá»± káº¿t há»£p huyá»n thoáº¡i"
        },
        notable: [
          {
            name: "Há»“ng Nhung",
            style: "Tráº» trung, hiá»‡n Ä‘áº¡i hÆ¡n báº£n gá»‘c",
            reception: "ÄÆ°á»£c Ä‘Ã¡nh giÃ¡ cao trong tháº¿ há»‡ má»›i"
          },
          {
            name: "Yoshimi Tendo (Nháº­t Báº£n)",
            style: "PhiÃªn báº£n tiáº¿ng Nháº­t",
            reception: "Ráº¥t thÃ nh cÃ´ng táº¡i Nháº­t Báº£n"
          }
        ]
      },
      sources: [
        {
          type: "book",
          name: "Trá»‹nh CÃ´ng SÆ¡n - Má»™t NgÆ°á»i ThÆ¡ Ca, Má»™t CÃµi Äi Vá»",
          author: "Nhiá»u tÃ¡c giáº£",
          reliability: "high"
        },
        {
          type: "interview",
          name: "Phá»ng váº¥n NgÃ´ VÅ© BÃ­ch Diá»…m - BÃ¡o Tuá»•i Tráº»",
          year: "2011",
          reliability: "high"
        },
        {
          type: "article",
          name: "Wikipedia tiáº¿ng Viá»‡t - Diá»…m XÆ°a",
          url: "https://vi.wikipedia.org/wiki/Diá»…m_xÆ°a",
          reliability: "medium"
        }
      ],
      metadata: {
        contentVersion: "2.0",
        reviewStatus: "verified",
        languageQuality: "formal-neutral"
      }
    },
    
    // ThÃªm nhiá»u bÃ i hÃ¡t khÃ¡c...
    "ná»—i buá»“n hoa phÆ°á»£ng-thanh sÆ¡n": {
      story: {
        summary: "Ná»—i Buá»“n Hoa PhÆ°á»£ng lÃ  ca khÃºc tiÃªu biá»ƒu cá»§a nháº¡c sÄ© Thanh SÆ¡n, sÃ¡ng tÃ¡c nÄƒm 1963, gáº¯n liá»n vá»›i tuá»•i há»c trÃ² vÃ  mÃ¹a hÃ¨ chia tay.",
        compositionContext: {
          when: "NÄƒm 1963",
          where: "SÃ i GÃ²n",
          inspiration: "Cáº£m xÃºc vá» mÃ¹a hÃ¨, ká»³ nghá»‰ há»c vÃ  sá»± chia ly cá»§a tuá»•i há»c trÃ²",
          process: "Viáº¿t trong giai Ä‘oáº¡n nháº¡c sÄ© Ä‘ang theo Ä‘uá»•i dÃ²ng nháº¡c trá»¯ tÃ¬nh",
          narrative: `"Ná»—i Buá»“n Hoa PhÆ°á»£ng" Ä‘Æ°á»£c nháº¡c sÄ© Thanh SÆ¡n sÃ¡ng tÃ¡c vÃ o nÄƒm 1963, trong giai Ä‘oáº¡n Ã´ng Ä‘ang sung sá»©c nháº¥t vá»›i dÃ²ng nháº¡c trá»¯ tÃ¬nh há»c Ä‘Æ°á»ng.

Ca khÃºc láº¥y cáº£m há»©ng tá»« hÃ¬nh áº£nh quen thuá»™c cá»§a mÃ¹a hÃ¨ miá»n Nam - nhá»¯ng hÃ ng phÆ°á»£ng vÄ© ná»Ÿ Ä‘á» rá»±c bÃ¡o hiá»‡u mÃ¹a nghá»‰ há»c vÃ  sá»± chia tay cá»§a báº¡n bÃ¨. Vá»›i nhá»¯ng ngÆ°á»i Viá»‡t Nam, hoa phÆ°á»£ng gáº¯n liá»n vá»›i tuá»•i há»c trÃ², vá»›i nhá»¯ng má»‘i tÃ¬nh Ä‘áº§u e áº¥p vÃ  ná»—i buá»“n man mÃ¡c khi hÃ¨ vá».

Thanh SÆ¡n Ä‘Ã£ Ä‘áº·t nhá»¯ng ca tá»« giáº£n dá»‹ nhÆ°ng giÃ u cáº£m xÃºc: "Má»—i nÄƒm Ä‘áº¿n hÃ¨ lÃ²ng man mÃ¡c buá»“n" - cÃ¢u hÃ¡t má»Ÿ Ä‘áº§u Ä‘Ã£ nÃ³i lÃªn tÃ¢m tráº¡ng cá»§a biáº¿t bao tháº¿ há»‡ há»c sinh khi ká»³ nghá»‰ hÃ¨ Ä‘áº¿n.

BÃ i hÃ¡t nhanh chÃ³ng trá»Ÿ thÃ nh má»™t trong nhá»¯ng ca khÃºc "kinh Ä‘iá»ƒn" vá» tuá»•i há»c trÃ², Ä‘Æ°á»£c hÃ¡t trong cÃ¡c buá»•i lá»… tá»•ng káº¿t nÄƒm há»c táº¡i nhiá»u trÆ°á»ng há»c miá»n Nam trÆ°á»›c 1975 vÃ  tiáº¿p tá»¥c phá»• biáº¿n cho Ä‘áº¿n ngÃ y nay.`
        },
        historicalContext: {
          era: "Äáº§u tháº­p niÃªn 1960, miá»n Nam Viá»‡t Nam",
          musicalMovement: "DÃ²ng nháº¡c trá»¯ tÃ¬nh, nháº¡c vÃ ng miá»n Nam",
          socialBackground: "Giai Ä‘oáº¡n tÆ°Æ¡ng Ä‘á»‘i á»•n Ä‘á»‹nh, vÄƒn hÃ³a Ã¢m nháº¡c phÃ¡t triá»ƒn máº¡nh táº¡i SÃ i GÃ²n",
          culturalSignificance: "Trá»Ÿ thÃ nh bÃ i hÃ¡t biá»ƒu tÆ°á»£ng cho tuá»•i há»c trÃ² Viá»‡t Nam"
        },
        confidence: "high",
        disclaimer: null
      },
      author: {
        fullName: "Thanh SÆ¡n (LÃª Thanh SÆ¡n)",
        birthYear: "1938",
        deathYear: "2012",
        birthPlace: "SÃ³c TrÄƒng",
        biography: `Nháº¡c sÄ© Thanh SÆ¡n (1938-2012) tÃªn tháº­t lÃ  LÃª Thanh SÆ¡n, quÃª gá»‘c SÃ³c TrÄƒng. Ã”ng lÃ  má»™t trong nhá»¯ng nháº¡c sÄ© cÃ³ nhiá»u Ä‘Ã³ng gÃ³p cho dÃ²ng nháº¡c trá»¯ tÃ¬nh Viá»‡t Nam vá»›i hÆ¡n 500 ca khÃºc.

Thanh SÆ¡n ná»•i tiáº¿ng vá»›i nhá»¯ng bÃ i hÃ¡t vá» quÃª hÆ°Æ¡ng, tuá»•i há»c trÃ² vÃ  tÃ¬nh yÃªu Ä‘Ã´i lá»©a. Phong cÃ¡ch Ã¢m nháº¡c cá»§a Ã´ng mang Ä‘áº­m cháº¥t dÃ¢n gian Nam Bá»™, giai Ä‘iá»‡u dá»… nghe, ca tá»« bÃ¬nh dá»‹ mÃ  sÃ¢u láº¯ng.

Nhá»¯ng ca khÃºc tiÃªu biá»ƒu: Ná»—i Buá»“n Hoa PhÆ°á»£ng, Hoa Sá»© NhÃ  NÃ ng, MÆ°a TrÃªn Phá»‘ Huáº¿, ThÆ°Æ¡ng Vá» Miá»n Trung...`,
        musicalStyle: "Nháº¡c trá»¯ tÃ¬nh, bolero, ca tá»« bÃ¬nh dá»‹, giai Ä‘iá»‡u dÃ¢n gian Nam Bá»™"
      },
      sources: [
        {
          type: "article",
          name: "Wikipedia tiáº¿ng Viá»‡t - Thanh SÆ¡n",
          url: "https://vi.wikipedia.org/wiki/Thanh_SÆ¡n_(nháº¡c_sÄ©)",
          reliability: "medium"
        }
      ]
    }
  };
}
```

---

## ğŸ”§ PHáº¦N 3: COMPONENT HIá»‚N THá»Š NÃ‚NG Cáº¤P

### Cáº­p nháº­t `SongStoryPanel.tsx` Ä‘á»ƒ hiá»ƒn thá»‹ Ä‘Ãºng cáº¥u trÃºc má»›i:

```tsx
// ThÃªm types má»›i
interface EnhancedSongStory {
  story: {
    summary: string;
    compositionContext: {
      when: string | null;
      where: string | null;
      inspiration: string | null;
      process: string | null;
      narrative: string;
    };
    historicalContext?: {
      era: string;
      musicalMovement: string;
      socialBackground: string;
      culturalSignificance: string;
    };
    behindTheScenes?: {
      realPeople: string;
      relationships: string;
      publicReception: string;
      legacy: string;
    };
    interestingFacts?: string[];
    confidence: 'high' | 'medium' | 'low';
    disclaimer?: string | null;
  };
  author: {
    fullName: string;
    birthYear?: string;
    deathYear?: string;
    birthPlace?: string;
    biography: string;
    musicalStyle?: string;
    notableWorks?: string[];
  };
  performers?: {
    original: {
      name: string;
      year: string;
      significance: string;
    };
    notable?: Array<{
      name: string;
      style: string;
      reception: string;
    }>;
  };
  sources: Array<{
    type: string;
    name: string;
    author?: string;
    year?: string;
    url?: string;
    reliability: 'high' | 'medium';
  }>;
  metadata: {
    contentVersion: string;
    reviewStatus: string;
    generatedAt: string;
  };
}

// Component hiá»ƒn thá»‹ Ä‘á»™ tin cáº­y
function ConfidenceBadge({ level }: { level: 'high' | 'medium' | 'low' }) {
  const config = {
    high: { color: 'bg-green-500/20 text-green-400 border-green-500/30', label: 'ÄÃ£ xÃ¡c minh' },
    medium: { color: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30', label: 'Cáº§n kiá»ƒm chá»©ng' },
    low: { color: 'bg-red-500/20 text-red-400 border-red-500/30', label: 'ThÃ´ng tin háº¡n cháº¿' }
  };
  
  return (
    <span className={`px-2 py-1 rounded-full text-caption border ${config[level].color}`}>
      {config[level].label}
    </span>
  );
}

// Component hiá»ƒn thá»‹ nguá»“n tham kháº£o
function SourcesList({ sources }: { sources: EnhancedSongStory['sources'] }) {
  if (!sources || sources.length === 0) return null;
  
  return (
    <div className="mt-4 pt-4 border-t border-glass-border">
      <div className="flex items-center gap-2 mb-3">
        <LinkIcon className="w-3.5 h-3.5 text-muted" />
        <span className="text-footnote text-muted">Nguá»“n tham kháº£o</span>
      </div>
      <div className="space-y-2">
        {sources.map((source, index) => (
          <div key={index} className="flex items-start gap-2">
            <span className={`px-1.5 py-0.5 rounded text-caption ${
              source.reliability === 'high' 
                ? 'bg-green-500/10 text-green-400' 
                : 'bg-yellow-500/10 text-yellow-400'
            }`}>
              {source.type}
            </span>
            <div className="flex-1">
              {source.url ? (
                <a 
                  href={source.url} 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-caption text-secondary hover:text-aurora-blue"
                >
                  {source.name}
                </a>
              ) : (
                <span className="text-caption text-secondary">{source.name}</span>
              )}
              {source.author && (
                <span className="text-caption text-muted"> â€” {source.author}</span>
              )}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

## âœ… TÃ“M Táº®T NÃ‚NG Cáº¤P

| KhÃ­a cáº¡nh | TrÆ°á»›c | Sau |
|-----------|-------|-----|
| **Prompt Length** | ~200 words | ~2000 words |
| **Äá»™ chi tiáº¿t** | Generic | Specific, contextual |
| **Nguá»“n tham kháº£o** | KhÃ´ng cÃ³ | Báº¯t buá»™c, cÃ³ reliability rating |
| **Confidence Level** | KhÃ´ng cÃ³ | high/medium/low |
| **Xá»­ lÃ½ thiáº¿u info** | Bá»‹a | Ghi rÃµ "chÆ°a cÃ³ thÃ´ng tin" |
| **NgÃ´n ngá»¯** | Cáº£m tÃ­nh | Trung láº­p, há»c thuáº­t |
| **Bá»‘i cáº£nh lá»‹ch sá»­** | KhÃ´ng | Äáº§y Ä‘á»§ era, movement, context |
| **Mock data** | Generic | Pre-researched Vietnamese songs |
| **Model** | gpt-4 | gpt-4-turbo-preview |
| **Temperature** | 0.7 | 0.3 (more factual) |

---

**File nÃ y sáº½ giÃºp ná»™i dung AI Ä‘áº¡t cháº¥t lÆ°á»£ng CAO Cáº¤P, CHÃNH XÃC nhÆ° má»™t bÃ i viáº¿t trÃªn táº¡p chÃ­ Ã¢m nháº¡c uy tÃ­n!** ğŸ“šğŸµ

Báº¡n cÃ³ muá»‘n tÃ´i táº¡o thÃªm **database cÃ¡c bÃ i hÃ¡t Viá»‡t Nam ná»•i tiáº¿ng** Ä‘Ã£ Ä‘Æ°á»£c nghiÃªn cá»©u ká»¹ (Bolero, Tiá»n chiáº¿n, Trá»‹nh...) khÃ´ng? ğŸ‡»ğŸ‡³
